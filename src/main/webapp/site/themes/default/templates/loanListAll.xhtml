<ui:composition template="page.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:pm="http://primefaces.org/mobile"
				xmlns:fn="http://java.sun.com/jsp/jstl/functions"
				xmlns:o="http://omnifaces.org/ui"
				xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:sec="http://www.springframework.org/security/facelets/tags">
	<ui:define name="content">
		<link type="text/css" rel="stylesheet"
			  href="#{tplVars.themeStylePath}/p2c.css" />

		<div class="main">
			<div class="tag">
				<span><a href="#{path}/">首页</a> ></span><span><a href="#{path}/loan-list-all">我要理财</a> > </span><a style="font-size: 15px;" href="#">所有项目列表</a>
			</div>
			<h:form>
				<div class="xmzt">

					<!--清除筛选对分页的影响 -->
					<p:remoteCommand process="@this" immediate="true" name="clearPage"
									 actionListener="#{loanList.setCurrentPage(1)}"></p:remoteCommand>
					<div class="xmzt_l">
						<div class="zt zt_01">
							<p>项目状态：</p>
							<div class="zt01">
								<h:commandLink styleClass="hover" title="全部" value="全部">
									<f:ajax render="dataTable"
											listener="#{loanList.setLoanType('','')}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="可投资" value="可投资">
									<f:ajax render="dataTable"
											listener="#{loanList.setLoanType(LoanStatus.RAISING,'')}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="还款中" value="还款中">
									<f:ajax render="dataTable"
											listener="#{loanList.setLoanType(LoanStatus.REPAYING,LoanStatus.REPAYING_BACK)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="已结清" value="已结清">
									<f:ajax render="dataTable"
											listener="#{loanList.setLoanType(LoanStatus.COMPLETE,'')}"></f:ajax>
								</h:commandLink>
							</div>
							<div class="clear"></div>
						</div>
						<div class="zt zt_01">
							<p>项目期限：</p>
							<div class="zt01">
								<h:commandLink styleClass="hover" title="全部" value="全部">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxDeadline(0,100)}">
									</f:ajax>
								</h:commandLink>
								<h:commandLink title="3个月以内" value="3个月以内">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxDeadline(0,3)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="3~6个月" value="3~6个月">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxDeadline(3,6)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="6~12个月" value="6~12个月">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxDeadline(6,12)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="12个月以上" value="12个月以上">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxDeadline(12,1000)}"></f:ajax>
								</h:commandLink>
							</div>
							<div class="clear"></div>
						</div>
						<div class="zt zt_01">
							<p>项目收益：</p>
							<div class="zt01">
								<h:commandLink styleClass="hover" title="全部" value="全部">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxRate(0.01,0.25)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="10%以下" value="10%以下">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxRate(0,0.1)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="10%-15%" value="10%-15%">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxRate(0.1,0.15)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="15%-20%" value="15%-20%">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxRate(0.15,0.2)}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="20%以上" value="20%以上">
									<f:ajax render="dataTable"
											listener="#{loanList.setMinAndMaxRate(0.2,10)}"></f:ajax>
								</h:commandLink>
							</div>
							<div class="clear"></div>
						</div>
						<div class="zt zt_01">
							<p>项目类型：</p>
							<div class="zt01">
								<h:commandLink styleClass="hover" title="全部" value="全部">
									<f:ajax render="dataTable"
											listener="#{loanList.example.setBusinessType('')}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="易盈家" value="易盈家">
									<f:ajax render="dataTable"
											listener="#{loanList.example.setBusinessType('houseType')}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="易福车" value="易福车">
									<f:ajax render="dataTable"
											listener="#{loanList.example.setBusinessType('carType')}"></f:ajax>
								</h:commandLink>
								<h:commandLink title="易诺信" value="易诺信">
									<f:ajax render="dataTable"
											listener="#{loanList.example.setBusinessType('creditType')}"></f:ajax>
								</h:commandLink>
								<a href="#{path}/gsj" >国商金</a>
								<a href="#{path}/rxy" >任逍遥</a>
								<a href="#{path}/jjy" >月月盈</a>
							</div>
							<div class="clear"></div>
						</div>
					</div>

					<!--<div class="xmzt_r">-->
					<!--<p>-->
					<!--<span>数据统计</span>-->
					<!--<br />-->
					<!--融资项目：#{loanStatistics.getLoanRSCount('企业贷')}个<br />-->
					<!--累计成交：-->
					<!--<h:outputText value="#{investStatistics.getAllInvestsMoney('企业贷')}">-->
					<!--<f:convertNumber />-->
					<!--</h:outputText>元<br />-->
					<!--投资笔数：#{investStatistics.getAllSuccessInvestsNum('企业贷')}笔-->
					<!--<br />投 标 中：#{loanStatistics.getLoanCount(LoanStatus.RAISING, '企业贷')}个-->
					<!--</p>-->
					<!--</div>-->
					<div class="clear"></div>
				</div>
				<div class="content" style="margin-top: 20px; border-top: 1px solid #CBCACA;">
					<h:panelGroup id="dataTable">
						<ui:param name="restriction"
								  value="#{'(loan.status=\''}#{LoanStatus.RAISING}#{'\' or loan.status=\''}#{LoanStatus.COMPLETE}#{''}#{'\' or loan.status=\''}#{LoanStatus.RECHECK}#{'\' or loan.status=\''}#{LoanStatus.REPAYING}#{'\')'}"></ui:param>
						<f:event type="preRenderComponent"
								 listener="#{loanList.addRestriction(restriction)}"></f:event>
						<f:event type="preRenderComponent"
								 listener="#{loanList.setPageSize(7)}"></f:event>
						<f:event type="preRenderComponent"
								 listener="#{loanList.addOrder('loan.seqNum','desc')}"></f:event>
						<!--<f:event type="preRenderComponent"-->
						<!--listener="#{loanList.example.setBusinessType('企业贷')}"></f:event>-->
						<ui:param name="orderColumn" value="#{'(case loan.status when \''}#{LoanStatus.RAISING}#{'\' then 1 when \''}#{LoanStatus.RECHECK}#{'\' then 2 when \''}#{LoanStatus.REPAYING_BACK}#{'\' then 3 when \''}#{LoanStatus.REPAYING}#{'\' then 4 else 5 end)'}"></ui:param>
						<f:event type="preRenderComponent"
								 listener="#{loanList.addOrder(orderColumn, 'asc')}"></f:event>
						<f:event type="preRenderComponent"
								 listener="#{loanList.addOrder('loan.commitTime','desc')}"></f:event>
						<ui:repeat var="loan" value="#{loanList.lazyModelData}">
							<div class="con_box">
								<div class="con_l">
									<center style="padding-top: 10px;">
										<ui:fragment rendered="#{loan.businessType =='houseType'}">
											<a href="#{path}/loanDetail/#{loan.id}" ><img
													style="width: 35px;"
													src="#{tplVars.themeImagePath}/house_icon.png" /></a>
										</ui:fragment>
										<ui:fragment rendered="#{loan.businessType =='carType'}">
											<a href="#{path}/loanDetail/#{loan.id}" ><img
													style="width: 35px;"
													src="#{tplVars.themeImagePath}/car_icon.png" /></a>
										</ui:fragment>
										<ui:fragment rendered="#{loan.businessType =='creditType'}">
											<a href="#{path}/loanDetail/#{loan.id}" ><img
													style="width: 35px;"
													src="#{tplVars.themeImagePath}/credit_icon.png" /></a>
										</ui:fragment>
									</center>
								</div>
								<div class="con_c">
									<h3 >
										<a href="#{path}/loanDetail/#{loan.id}">#{fn:substring(loan.name,0,66)}</a>
									</h3>
									<style>
										.loan_content li{
										float:left;
										width:50%;
										}

										.loan_content span{
										font-size:24px;
										}
									</style>
									<ul class="loan_content">
										<li>年化收益：<span><h:outputText value="#{loan.ratePercent}">
											<f:convertNumber minFractionDigits="0" />
										</h:outputText></span>%</li>
										<li>项目期限：<span>#{loan.deadline*loan.type.repayTimePeriod}</span>(#{dictUtil.getValue('repay_unit',loan.type.repayTimeUnit)})</li>
										<li style="margin-top:12px">还款方式：#{dictUtil.getValue('repay_type',loan.type.repayType)}</li>
										<li>项目规模：<span><h:outputText value="#{loan.loanMoney}">
											<f:convertNumber type="number" />
										</h:outputText></span>元</li>
									</ul>
								</div>

								<div style=" float: left;margin-top: 15px;">
									<div class="top_line">
										<img  style="height: 100px;" src="#{tplVars.themeImagePath}/line04.png" />
									</div>
								</div>
								<div class="con_r" style="margin-top:30px">
									<div class="boxp10">
										<ui:param name="cr"
												  value="#{loanCalculator.calculateRaiseCompletedRate(loan.id)}"></ui:param>
										进度：<span class="jdt jd"><em><b
											style="width: #{cr}%"></b></em><i>#{cr}%</i></span>
									</div>
									<ui:fragment rendered="#{loan.status ==LoanStatus.RAISING}">
										<a href="#{path}/loanDetail/#{loan.id}"
										   class="txczje02_btn list_btn">立即投标</a>
									</ui:fragment>
									<ui:fragment rendered="#{loan.status !=LoanStatus.RAISING}">
										<a href="#{path}/loanDetail/#{loan.id}"
										   class="txczje02_btn list_btn list_btn02">查看详情</a>
									</ui:fragment>
								</div>
							</div>
						</ui:repeat>
						<div class="page02">
							<ui:include src="#{tplVars.componentsPath}/loanPaging.xhtml"></ui:include>
						</div>
					</h:panelGroup>
				</div>
			</h:form>
		</div>
		<script type="text/javascript">
			$(".xmzt_l a").click(function() {
				$(this).parent().children().removeClass("hover");
				$(this).addClass("hover");
				//清除筛选对分页的影响
				clearPage();
			});
		</script>
	</ui:define>
</ui:composition>