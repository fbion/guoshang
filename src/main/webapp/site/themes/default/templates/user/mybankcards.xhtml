<ui:composition template="center.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pm="http://primefaces.org/mobile"
                xmlns:archer="http://java.sun.com/jsf/archer"
                xmlns:sec="http://www.springframework.org/security/facelets/tags"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:param name="activeCenterMenuUrl" value="/user/bankCardList"></ui:param>
    <ui:define name="center_right">
        <script type="text/javascript">
			function alreadyHas(){
				if($(".valid-card")[0]){
					alert("只能绑定一张银行卡，请先执行解绑操作。");
					return false;
				}
			}

			/** 显示dialog*/
			function showPass() {
				$.artDialog({
					content : document.getElementById('passDialog'),
					id : 'pass',
					fixed : true,
					lock : true,
					time : 3600,
					close:function(){
					   window.location.href='/user/bankCardList';
					}
				});
			}


        </script>
        <!-- 	未实名认证 -->
        <sec:ifNotGranted roles="INVESTOR">
            <script>
				$.dialog
						.alert(
								'您尚未拥有投资权限，请先进行实名认证!',
								function() {
									window.location.href = "#{path}/user/get_investor_permission";
								});


            </script>
        </sec:ifNotGranted>
        <!-- 	已实名认证 -->
        <sec:ifAllGranted roles="INVESTOR">
            <f:event type="preRenderComponent"
                     listener="#{userHome.setId(loginUserInfo.loginUserId)}"></f:event>
            <div class="center_right">
                <h:form id="form">
                    <div class="zhcz_h3">已添加银行卡</div>
                    <ul class="yhkxx">
                        <ui:repeat var="bankcard" value="#{bankCardList.getBankCardListbyLoginUser()}">
                            <ui:fragment rendered="#{bankcard.status ne BankCardStatus.DELETED}">
                                <li>
                                    <div class="yhk"><img
                                            src="#{tplVars.themeImagePath}/yeepaybanklogo/#{bankcard.bankNo}.png"/>
                                        <br/>
                                        <ui:param name="bcnL" value="#{bankcard.cardNo.length()}"></ui:param>
                                        <p>#{fn:substring(bankcard.cardNo ,0,4)}**** ****
                                            #{fn:substring(bankcard.cardNo ,bcnL-4,bcnL)}</p>
                                    </div>
                                    <ui:fragment rendered="#{bankcard.status == 'VERIFIED' }">
                                        <a class="yhkxx_l valid-card" style="cursor:default" href="javascript:void(0);">通过</a>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{bankcard.status == 'BINDING_WAIT' }">
                                        <a class="yhkxx_l valid-card" style="cursor:default" href="javascript:void(0);">通过</a>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{bankcard.status == 'VERIFYING'}">
                                        <a class="yhkxx_l valid-card" style="cursor:default" href="javascript:void(0);">
                                            审核中</a>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{bankcard.status == 'FAIL'}">
                                        <a class="yhkxx_l" href="javascript:void(0);" style="cursor:default">审核失败</a>
                                    </ui:fragment>

                                    <ui:fragment rendered="#{bankcard.status == 'VERIFIED'}">
                                        <a class="yhkxx_r" href="javascript:showPass();">解绑</a>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{bankcard.status == 'BINDING_WAIT'}">
                                        <a class="yhkxx_r" style="cursor:default" href="javascript:void(0);">解绑中</a>
                                    </ui:fragment>
                                    <div class="clear"></div>
                                </li>
                            </ui:fragment>
                        </ui:repeat>

                        <ui:fragment rendered="#{bankCardList.hasBankCard() eq 0 }">
                            <li>
                                <div class="yhk">
                                    <h:commandLink target="_blank" action="#{bankCardHome.bindingCardTrusteeship}"
                                                   onclick="return alreadyHas()">
                                        <img class="jia" src="#{tplVars.themeImagePath}/img46.png"/>
                                    </h:commandLink>
                                    <!--
                                            <p:commandLink actionListener="#{bankCardHome.setInstance(null)}"
                                                onclick="$('form\\:recardNo').val('')" process="@this"
                                                update="@form">
                                                <img class="jia" src="#{tplVars.themeImagePath}/img46.png" />
                                            </p:commandLink>
                                            -->
                                </div>

                                <h:commandLink styleClass="yhkxx_c" value="新增银行卡" target="_blank"
                                               action="#{bankCardHome.bindingCardTrusteeship}"
                                               onclick="return alreadyHas()">
                                </h:commandLink>
                                <!--
                                <p:commandLink actionListener="#{bankCardHome.setInstance(null)}"
                                    onclick="$('form\\:recardNo').val('')" process="@this"
                                    update="@form" styleClass="yhkxx_c" value="新增银行卡"></p:commandLink>
                                -->
                                <div class="clear"></div>
                            </li>
                        </ui:fragment>
                        <div class="clear"></div>
                    </ul>

                </h:form>
                <p class="zhcz_p02">
                    温馨提示<br/> 1、如果您填写的开户行支行不正确，可能将无法成功提现，由此产生的提现费用将不予返还。<br/>
                    2、如果您不确定开户行支行名称，可打电话到所在地银行的营业网点询问或上网查询。<br/> 3、不支持提现至信用卡账户。
                </p>
            </div>
            <div class="clear"></div>
            <div id="passDialog" style="display: none">
                <h:panelGroup id="pass">
                    <p> 安全验证>输入登录密码</p>
                    <h:form>
                        <h:inputSecret id="vaiPass" label="登录密码" value="#{bankCardHome.vaiPass}" required='true'>
                            <f:ajax event="blur"></f:ajax>
                        </h:inputSecret>
                        <p:commandButton
                                action="#{bankCardHome.unbindingCardS2STrusteeship}"
                                value="确认"></p:commandButton>
                    </h:form>
                </h:panelGroup>
            </div>


        </sec:ifAllGranted>
    </ui:define>

</ui:composition>